(window.webpackJsonpy=window.webpackJsonpy||[]).push([[0],{101:function(e,t,n){},103:function(e,t,n){},104:function(e,t,n){},105:function(e,t,n){},106:function(e,t,n){},107:function(e,t,n){},108:function(e,t,n){},109:function(e,t,n){},110:function(e,t,n){},136:function(e,t,n){},138:function(e,t,n){"use strict";n.r(t);var a=n(13),r=n(28),s=n(9),i=n(7),o=n(10),c=n(11),l=n(12),u=n(0),p=n.n(u),d=(n(89),n(90),function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(o.a)(this,Object(c.a)(t).call(this,e))).state={id:e.id,name:e.name,on:e.on,code:e.code,language:e.language,effects:e.effects,holdTime:new Date},n}return Object(l.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return p.a.createElement("div",{className:"Stem noselect"+(this.props.on?" on ":" off ")+(this.props.selected?"selected":""),tabIndex:0,onKeyUp:this.onKeyUp.bind(this),onMouseUp:this.mouseDown.bind(this),onContextMenu:function(t){t.preventDefault(),e.openInFlyout()}},p.a.createElement("div",{className:"verticalCenter",style:{width:"100%"}},this.props.name))}},{key:"onKeyUp",value:function(e){e.ctrlKey&&"v"===e.key&&this.props.globalActions.pasteStems(this.props.trackId,this.props.id)}},{key:"mouseUp",value:function(){new Date-this.state.holdTime>1e3?this.openInFlyout():this.toggle()}},{key:"onTouchStart",value:function(){this.toggle()}},{key:"mouseDown",value:function(e){e.shiftKey?this.props.globalActions.updateStem(this.props.trackId,this.props.id,{selected:!this.props.selected}):e.button?e.preventDefault():this.toggle()}},{key:"openInFlyout",value:function(){this.props.globalActions.updateStem(this.props.trackId,this.state.id,{open:!0})}},{key:"toggle",value:function(){this.props.globalActions.updateStem(this.props.trackId,this.props.id,{on:!this.props.on})}}]),t}(u.Component)),f=(n(91),function(e){function t(){return Object(s.a)(this,t),Object(o.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return p.a.createElement("div",Object.assign({},this.props,{className:"plusButton"}),p.a.createElement("div",null,"+"))}}]),t}(u.Component)),h=(n(92),n(176)),m=n(172),_=n(177),v=n(173),b=n(59),E=n.n(b),g=function(e){function t(e){var n;Object(s.a)(this,t);var a=(n=Object(o.a)(this,Object(c.a)(t).call(this,e))).toSliderScale(n.props.value);return n.state={value:n.props.value,sliderValue:a},n.updateState=E()(n._handleSliderChange,200),n.handleInputChange=E()(n._handleInputChange,200),n}return Object(l.a)(t,e),Object(i.a)(t,[{key:"toSliderScale",value:function(e){if("log"===this.props.scale){var t=this.props.max-this.props.min;return Math.pow(e/t,.5)*t}return e}},{key:"fromSliderScale",value:function(e){if("log"===this.props.scale){var t=this.props.max-this.props.min;return Math.round(Math.pow(e/t,2)*t*this.props.step)/this.props.step}return e}},{key:"render",value:function(){return this.props.isVertical?this.renderVertical():this.renderHorizontal()}},{key:"_handleSliderChange",value:function(e,t){if(t){var n=Object.assign({},this.props,{value:this.fromSliderScale(t)});delete n.updateEffect,this.props.updateEffect(n)}}},{key:"_handleInputChange",value:function(e){var t=parseFloat(e.target.value),n=Object.assign({},this.props,{value:t});delete n.updateEffect,this.props.updateEffect(n)}},{key:"toggle",value:function(e){var t=e.target.checked,n=Object.assign({},this.props,{on:t});delete n.updateEffect,this.props.updateEffect(n)}},{key:"renderHorizontal",value:function(){var e=this;return p.a.createElement("div",{className:"Effect horizontal"},this.props.name,this.props.noToggle?null:p.a.createElement(h.a,{color:"primary",onChange:this.toggle.bind(this),checked:this.props.on}),p.a.createElement(m.a,{container:!0,spacing:2,alignItems:"center"},p.a.createElement(m.a,{item:!0,xs:!0},p.a.createElement(_.a,{onChange:function(t,n){n&&(e.setState({sliderValue:n,value:e.fromSliderScale(n)}),e.updateState(t,n))},min:this.props.min,max:this.props.max,step:this.props.step,value:parseFloat(this.state.sliderValue)})),p.a.createElement(m.a,{item:!0},p.a.createElement(v.a,{margin:"dense",onChange:function(t){var n=parseFloat(t.target.value);t.persist(),e.setState({value:n,sliderValue:e.toSliderScale(n)}),e.handleInputChange.bind(e)(t)},value:this.state.value,inputProps:{step:this.props.step,min:this.props.min,max:this.props.max,type:"number","aria-labelledby":"input-slider"}}))))}},{key:"renderVertical",value:function(){var e=this;return p.a.createElement("div",{className:"Effect vertical"},p.a.createElement(_.a,{orientation:"vertical",onChange:function(t,n){n&&(e.setState({sliderValue:n,value:e.fromSliderScale(n)}),e.updateState(t,n))},min:this.props.min,max:this.props.max,step:this.props.step,value:parseFloat(this.state.sliderValue)}),p.a.createElement(v.a,{margin:"dense",onChange:function(t){var n=parseFloat(t.target.value);t.persist(),e.setState({value:n,sliderValue:e.toSliderScale(n)}),e.handleInputChange.bind(e)(t)},value:this.props.value,inputProps:{step:this.props.step,min:this.props.min,max:this.props.max,type:"number","aria-labelledby":"input-slider"}}),p.a.createElement("div",{style:{textAlign:"center"}},this.props.name,this.props.noToggle?null:p.a.createElement(h.a,{color:"primary",onChange:this.toggle.bind(this),checked:this.props.on})))}}]),t}(u.Component),O=function(e){function t(){return Object(s.a)(this,t),Object(o.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(i.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return JSON.stringify(e)!=JSON.stringify(this.props)}},{key:"render",value:function(){var e=this,t=this.props.stems.map(function(t){return t.globalActions=e.props.globalActions,p.a.createElement(d,Object.assign({key:t.id},t))});return p.a.createElement("div",{className:"Track"},p.a.createElement("input",{onChange:this.titleChange.bind(this),value:this.props.name}),p.a.createElement("div",{className:"stems"},t,p.a.createElement(f,{onClick:this.addStem.bind(this)})),p.a.createElement("div",{className:"effects"},p.a.createElement("div",{className:"launchButton"},p.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"var(--font-color-dark)",width:"24",height:"24",viewBox:"0 0 24 24"},p.a.createElement("path",{d:"M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"}),p.a.createElement("path",{d:"M0 0h24v24H0z",fill:"none"}))),p.a.createElement(g,Object.assign({isVertical:!0,noToggle:!0,updateEffect:this.updateEffect.bind(this)},this.props.effects[0]))))}},{key:"updateEffect",value:function(e){var t=this.props.effects.map(function(t){return t.id===e.id?e:t});this.props.globalActions.updateTrack({id:this.props.id,effects:t})}},{key:"addStem",value:function(){this.props.globalActions.addStem(this.props.id)}},{key:"titleChange",value:function(e){this.props.globalActions.updateTrack({id:this.props.id,name:e.target.value})}}]),t}(u.Component),y=(n(101),function(e){function t(){return Object(s.a)(this,t),Object(o.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(i.a)(t,[{key:"trackToDom",value:function(e){return e.globalActions=this.props.globalActions,p.a.createElement(O,Object.assign({key:e.id},e))}},{key:"render",value:function(){var e=this.props.tracks.map(this.trackToDom.bind(this));return p.a.createElement("div",{className:"LaunchSpace",style:this.props.style,tabIndex:"1",onKeyUp:this.onKeyUp.bind(this)},e,p.a.createElement(f,{onClick:this.newTrack.bind(this),style:{display:"inline-block",top:"0px",width:"50px",minWidth:"50px",height:"30px",margin:"5px"}}))}},{key:"onKeyUp",value:function(e){var t=this;if("delete"===e.key.toLowerCase())this.props.tracks.map(function(e){return e.stems}).flat().filter(function(e){return e.selected}).forEach(function(e){t.props.globalActions.removeStem(e.trackId,e.id)});else if(e.ctrlKey&&"c"===e.key.toLowerCase())this.props.globalActions.copyStems();else if("escape"===e.key.toLowerCase()){this.props.tracks.map(function(e){return e.stems}).flat().filter(function(e){return e.selected}).forEach(function(e){return t.props.globalActions.updateStem(e.trackId,e.id,{selected:!1})})}}},{key:"newTrack",value:function(){this.props.globalActions.addTrack()}}]),t}(u.Component)),k={CONNECT:function(e,t,n){return{type:"CONNECT",url:e,port:t,isConnected:n}},UPDATE_TEMPO:function(e){return{type:"UPDATE_TEMPO",tempo:e}},UPDATE_BOOT_SCRIPT:function(e){return{type:"UPDATE_BOOT_SCRIPT",bootScript:e}},COPY_STEMS:function(e){var t=e;t||(t=re.getState().tracks.map(function(e){return e.stems}).flat().filter(function(e){return e.selected}));return{type:"COPY_STEMS",stems:t}},PASTE_STEMS:function(e,t){return{type:"PASTE_STEMS",trackId:e,stemId:t}},ADD_TRACK:function(){return{type:"ADD_TRACK"}},REMOVE_TRACK:function(e){return{type:"ADD_TRACK",trackId:e}},ADD_STEM:function(e){return{type:"ADD_STEM",trackId:e}},REMOVE_STEM:function(e,t){return{type:"REMOVE_STEM",trackId:e,stemId:t}},UPDATE_STEM:function(e,t,n){return{type:"UPDATE_STEM",trackId:e,stemId:t,value:n}},UPDATE_TRACK:function(e){return{type:"UPDATE_TRACK",value:e}},TOGGLE_LIVE:function(e){return{type:"TOGGLE_LIVE",live:e}},UPDATE_MASTER_EFFECT:function(e){return{type:"UPDATE_MASTER_EFFECT",value:e}},SAVE:function(){return{type:"SAVE"}},LOAD:function(e){return{type:"LOAD",newState:e}},DOWNLOAD:function(){return{type:"DOWNLOAD"}},Types:{}};Object.keys(k).forEach(function(e){k.Types[e]=e});var T=k,C={init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.location.hostname,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8e3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){};C.ws&&C.ws.close(),window.WebSocket=window.WebSocket||window.MozWebSocket;try{C.ws=new WebSocket("ws://"+e+":"+t),C.ws.isOpen=!1,C.ws.onopen=function(){C.ws.isOpen=!0,console.log("ws connection established"),n()},C.ws.onerror=function(e){console.warn(e),r(e)},C.ws.onclose=function(e){console.warn("ws closed"),C.ws.isOpen=!1,a(e)}}catch(s){r()}},sendCode:function(e){C.ws&&C.ws.isOpen?C.ws.send(JSON.stringify({type:"eval",code:e})):console.warn("Connection is closed")}},D=C,S=n(23),j=n(17),A=n(21);function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}var w=["TidalCycles","Hydra"],M={getDefaultEffects:function(){return[{name:"gain",id:Object(S.uniqueId)(),on:!1,scale:"linear",operator:"|*",value:1,min:0,max:2,step:.01},{name:"lpf",operator:"#",id:Object(S.uniqueId)(),on:!1,scale:"log",value:22e3,min:0,max:22e3,step:10},{name:"hpf",id:Object(S.uniqueId)(),operator:"#",on:!1,scale:"log",value:0,min:0,max:22e3,step:10}]},getDefaultTrack:function(){var e=Object(S.uniqueId)();return{id:e,name:"New Track",stems:[0,0,0,0,0].map(function(t){return M.getDefaultStem(e)}),effects:[{name:"gain",id:Object(S.uniqueId)(),on:!0,scale:"linear",operator:"|*",value:1,min:0,max:2,step:.01}]}}};M.cloneStem=function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(n,!0).forEach(function(t){Object(A.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e,{effects:Object(j.a)(e.effects).map(function(e){return Object.assign({},e)}),id:Object(S.uniqueId)()})},M.getDefaultStem=function(e){return{id:Object(S.uniqueId)(),trackId:e,name:"",on:!1,selected:!1,open:!1,live:!1,language:"TidalCycles",code:"",effects:M.getDefaultEffects()}},M.defaultState={live:!0,tempo:120,copy:null,languages:w,bootScript:"",tracks:[0,0,0,0,0].map(function(e){return M.getDefaultTrack()}),masterEffects:[{name:"gain",id:Object(S.uniqueId)(),on:!1,scale:"linear",operator:"|*",value:1,min:0,max:2,step:.01},{name:"lpf",operator:"#",id:Object(S.uniqueId)(),on:!1,scale:"log",value:22e3,min:0,max:22e3,step:10},{name:"hpf",id:Object(S.uniqueId)(),operator:"#",on:!1,scale:"log",value:0,min:0,max:22e3,step:10}],connection:{isConnected:!1,url:"127.0.0.1",port:8001}},M.getDefaultEffect=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"gain";return{name:e,id:Object(S.uniqueId)(),on:!1,scale:"linear",operator:"|*",value:1,min:0,max:1,step:.01}};var P=M;var R=function(e){return{connect:function(t,n){var a=function(){e(T.CONNECT(t,n,!1))},r=a;D.init(t,n,function(){e(T.CONNECT(t,n,!0))},a,r)},updateTempo:function(t){e(T.UPDATE_TEMPO(t))},updateBootScript:function(t){e(T.UPDATE_BOOT_SCRIPT(t))},copyStems:function(t){e(T.COPY_STEMS(t))},pasteStems:function(t,n){e(T.PASTE_STEMS(t,n)),re.getState().tracks.forEach(function(t){t.stems.filter(function(e){return e.selected}).forEach(function(t){e(T.UPDATE_STEM(t.trackId,t.id,{selected:!1}))})})},addTrack:function(){e(T.ADD_TRACK())},removeTrack:function(t){e(T.REMOVE_TRACK(t))},addStem:function(t){e(T.ADD_STEM(t))},removeStem:function(t,n){e(T.REMOVE_STEM(t,n))},updateStem:function(t,n,a){e(T.UPDATE_STEM(t,n,a))},openInFlyout:function(t,n){e(T.OPEN_IN_FLYOUT(t,n))},updateTrack:function(t){e(T.UPDATE_TRACK(t))},updateMasterEffect:function(t){e(T.UPDATE_MASTER_EFFECT(t))},toggleLive:function(t){e(T.TOGGLE_LIVE(t))},save:function(){window.localStorage.setItem("state",JSON.stringify(re.getState())),console.log("saved")},load:function(){var t=window.localStorage.getItem("state");t?((t=function e(t){for(var n in t)"id"===n?t[n]=Object(S.uniqueId)():"object"===typeof t[n]&&(t[n]=e(t[n]));return t}(t=JSON.parse(t))).tracks.forEach(function(e){e.stems.forEach(function(t){t.trackId=e.id})}),e(T.LOAD(P.defaultState)),e(T.LOAD(t))):console.warn("Tried to load state but empty")},download:function(){var t="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(re.getState())),n=document.createElement("a");n.setAttribute("href",t),n.setAttribute("download","dead_state.json"),n.click(),e(T.DOWNLOAD())},openFile:function(t){if(t)t.text().then(function(t){e(T.LOAD(JSON.parse(t)))});else{var n=document.createElement("input");n.type="file",n.onchange=function(t){n.files[0].text().then(function(t){e(T.LOAD(JSON.parse(t)))})},n.click()}}}},x=Object(r.b)(function(e){return e},function(e){return{globalActions:R(e)}})(y),L=(n(103),n(104),n(175)),U=n(31),N=n.n(U),K=(n(105),n(174)),B=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(o.a)(this,Object(c.a)(t).call(this,e))).state={code:n.props.code},n.updateCode=N()(n.props.onChange,1e3),n.flashTimeout=null,n}return Object(l.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return p.a.createElement("div",{className:"CodeEditor"},"Live",p.a.createElement(h.a,{color:"primary",onChange:function(t){e.props.onChangeLive(t.target.checked)},checked:this.props.live}),p.a.createElement(K.a,{color:"primary",disabled:this.props.live,onClick:function(t){e.updateCode.bind(e)(t.target.value)},variant:"outlined"},"eval"),p.a.createElement("textarea",{className:this.state.flash?"flash":"",onKeyPress:this.onKeyPress.bind(this),onChange:function(t){e.setState({code:t.target.value}),e.props.live&&e.updateCode.bind(e)(t.target.value)},value:this.state.code}))}},{key:"onKeyPress",value:function(e){var t=this;e.shiftKey&&"Enter"===e.key&&(e.preventDefault(),this.props.onChange(this.state.code),clearTimeout(this.flashTimeout),this.setState({flash:!0}),this.flashTimeout=setTimeout(function(){t.setState({flash:!1})},1))}}]),t}(u.Component),W=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(o.a)(this,Object(c.a)(t).call(this,e))).state={connection:n.props.connection,bootScript:n.props.bootScript,bootScriptLive:!1},n.updateBootScript=N()(function(e){n.props.globalActions.updateBootScript(e)},4e3),n.connect=N()(function(){n.props.globalActions.connect(n.state.connection.url,n.state.connection.port)},2e3),n}return Object(l.a)(t,e),Object(i.a)(t,[{key:"updateEffect",value:function(e){this.props.globalActions.updateMasterEffect(e)}},{key:"render",value:function(){for(var e=this,t=[],n=0;n<this.props.masterEffects.length;n++){var a=this.props.masterEffects[n];t.push(p.a.createElement("div",{key:a.id,style:{margin:"5px",marginTop:"20px"}},p.a.createElement(g,Object.assign({updateEffect:this.updateEffect.bind(this)},a))))}return p.a.createElement("div",{className:"MasterEditor",style:this.props.style},p.a.createElement("div",{className:"separator"},p.a.createElement("h3",null,"Effects"),t),p.a.createElement("div",{className:"separator"},p.a.createElement("h3",null,"Tempo"),p.a.createElement(g,{key:Math.random(),noToggle:!0,name:"Tempo",id:"tempo",on:!0,scale:"linear",operator:"",min:0,max:200,value:this.props.tempo,step:.01,updateEffect:this.changeTempo.bind(this)})),p.a.createElement("div",{className:"separator"},p.a.createElement("h3",null,"Boot Script"),p.a.createElement(B,{key:Math.random(),onChange:function(t){e.props.globalActions.updateBootScript(t)},onChangeLive:function(t){e.setState({bootScriptLive:t})},code:this.props.bootScript,live:this.state.bootScriptLive})),p.a.createElement("div",{className:"separator",style:{border:this.props.connection.isConnected?"1pt solid var(--stem-off)":"1pt solid red"}},p.a.createElement("h3",null,"Connection"),p.a.createElement("div",null,p.a.createElement(L.a,{style:{width:"50%",marginLeft:"5px"},label:"URL",value:this.state.connection.url,onChange:function(t){var n=e.state.connection;n.url=t.target.value,e.setState({connection:n}),e.connect()},margin:"normal"}),p.a.createElement(L.a,{style:{width:"50%",marginLeft:"5px",maxWidth:"100px"},label:"Port",type:"number",value:this.state.connection.port,onChange:function(t){var n=e.state.connection;n.port=parseInt(t.target.value),e.setState({connection:n}),e.connect()},margin:"normal"}))))}},{key:"changeTempo",value:function(e){this.props.globalActions.updateTempo(e.value)}},{key:"connect",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props.connection.url,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.props.connection.port,a={url:t,port:n,isConnected:this.state.isConnected};this.setState({connection:a}),N()(function(){e.props.globalActions.connect(t,n)},3e3,{trailing:!0})()}},{key:"updateConnect",value:function(e,t){this.props.globalActions.connect(e,t)}},{key:"toggle",value:function(e){this.props.globalActions.toggleLive(e.target.checked)}}]),t}(u.Component),V=(n(106),function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(o.a)(this,Object(c.a)(t).call(this,e))).state={code:n.props.code},n.updateCode=N()(n._updateCode,1e3),n.textAreaRef=p.a.createRef(),n}return Object(l.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=[];for(var n in this.props.effects){var a=this.props.effects[n];t.push(p.a.createElement(g,Object.assign({key:a.id,updateEffect:this.updateEffect.bind(this)},a)))}return p.a.createElement("div",{className:"StemEditor",style:this.props.style},"Name:",p.a.createElement("input",{style:{backgroundColor:"var(--stem-off)"},onChange:this.updateName.bind(this),type:"text",value:this.props.name}),p.a.createElement("select",{value:this.props.language,onChange:this.handleLanguageChange.bind(this),name:"language"},w.map(function(e){return p.a.createElement("option",{key:e,value:e},e)})),p.a.createElement(B,{onChange:function(t){return e.props.globalActions.updateStem(e.props.trackId,e.props.id,{code:t})},onChangeLive:function(t){return e.props.globalActions.updateStem(e.props.trackId,e.props.id,{live:t})},code:this.props.code,live:this.props.live}),t,p.a.createElement(K.a,{style:{marginTop:"5px"},onClick:this.delete.bind(this),color:"primary",variant:"outlined"},"delete"))}},{key:"handleLanguageChange",value:function(e){this.props.globalActions.updateStem(this.props.trackId,this.props.id,{language:e.target.value,code:""})}},{key:"maybeEval",value:function(e){var t=this;e.shiftKey&&"Enter"===e.key&&(e.preventDefault(),this.props.globalActions.updateStem(this.props.trackId,this.props.id,{code:this.state.code}),this.textAreaRef.current.classList.add("flash"),setTimeout(function(){t.textAreaRef.current.classList.remove("flash")},250))}},{key:"delete",value:function(){this.props.globalActions.removeStem(this.props.trackId,this.props.id)}},{key:"updateLive",value:function(e){this.props.globalActions.updateStem(this.props.trackId,this.props.id,{live:e.target.checked})}},{key:"updateEffect",value:function(e){var t=this.props.effects.map(function(t){return t.id===e.id?e:t});this.props.globalActions.updateStem(this.props.trackId,this.props.id,{effects:t})}},{key:"updateName",value:function(e){this.props.globalActions.updateStem(this.props.trackId,this.props.id,{name:e.target.value})}},{key:"_updateCode",value:function(e){this.props.globalActions.updateStem(this.props.trackId,this.props.id,{code:e.target.value})}}]),t}(u.Component)),q=function(e){function t(){return Object(s.a)(this,t),Object(o.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return p.a.createElement("div",{onClick:this.props.switchToTab,className:"Tab"+(this.props.selected?"":" unselected")},p.a.createElement("label",null,this.props.label),this.props.closeAble?p.a.createElement("svg",{onClick:this.props.closeTab,xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 18 18"},p.a.createElement("path",{d:"M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"})):null,this.props.selected?p.a.createElement("div",{className:"indicator"}):null)}}]),t}(u.Component),F=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(o.a)(this,Object(c.a)(t).call(this,e))).state={tab:"master",history:[]},n}return Object(l.a)(t,e),Object(i.a)(t,[{key:"switchTab",value:function(e){var t=this._getOpenedStems().map(function(e){return e.id+"_"+e.trackId});if("master"===e||t.includes(e)){var n=this.state.history.concat([e]);this.setState({tab:e,history:n})}}},{key:"_getOpenedStems",value:function(){return this.props.tracks.map(function(e){return e.stems}).flat().filter(function(e){return e.open})}},{key:"closeTab",value:function(e,t){var n,a,r=this;this.state.history.length-1?(a=(a=this.state.history.slice(0,-1)).filter(function(n){return n!==t+"_"+e}),n=a[a.length-1]||"master"):(n="master",a=this.state.history),this.setState({tab:n,history:a}),setTimeout(function(){r.props.globalActions.updateStem(e,t,{open:!1}),r.setState({tab:n,history:a})},1)}},{key:"render",value:function(){var e=this,t=this.props.tracks.map(function(e){return e.stems}).flat().filter(function(e){return e.open});"master"===this.state.tab||t.map(function(e){return e.id+"_"+e.trackId}).includes(this.state.tab)||this.switchTab("master");var n=t.map(function(t){var n=t.id+"_"+t.trackId;return{tab:p.a.createElement(q,Object.assign({switchToTab:function(){e.switchTab.bind(e)(n)},value:n,label:""===t.name?"<untitled>":t.name,key:n,trackId:t.trackId,id:t.id,selected:e.state.tab===n,closeAble:!0,closeTab:function(){e.closeTab.bind(e)(t.trackId,t.id)}},e.props)),content:p.a.createElement(V,Object.assign({style:{display:e.state.tab===n?"block":"none"},value:n,key:n},t))}});return p.a.createElement("div",{className:"Flyout",style:this.props.style},p.a.createElement("div",{className:"scrollbarHidden"},p.a.createElement("div",{className:"TabContainer"},p.a.createElement(q,{switchToTab:function(){e.switchTab.bind(e)("master")},value:"master",label:"master",selected:"master"===this.state.tab}),n.map(function(e){return e.tab}))),p.a.createElement("div",{className:"content"},p.a.createElement(W,Object.assign({},this.props,{value:"master",style:{display:"master"===this.state.tab?"block":"none"}})),n.map(function(e){return e.content})))}}]),t}(u.Component),z=Object(r.b)(function(e){return e},function(e){return{globalActions:R(e)}})(F),H=(n(107),n(42)),J=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(o.a)(this,Object(c.a)(t).call(this,e))).iframeRef=p.a.createRef(),n.tempo="",n.bootScript=e.bootScript,n.tidalCode="",n.hydraCode="",n.poppedOut=[],n}return Object(l.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=H.a.TidalCycles.getCode(this.props);if(this.tempo!==this.props.tempo&&(D.sendCode(H.a.TidalCycles.getTempoCode(this.props)),this.tempo=this.props.tempo),this.bootScript!==this.props.bootScript&&(D.sendCode(this.props.bootScript),this.bootScript=this.props.bootScript),this.tidalCode!==e&&(console.log("tidal:",e),D.sendCode(e)),this.tidalCode=e,this.iframeRef.current&&this.iframeRef.current.contentWindow){var t=JSON.parse(JSON.stringify(this.props));this.iframeRef.current.contentWindow.postMessage({state:t}),this.poppedOut.length&&this.poppedOut.forEach(function(e){e.postMessage({state:t})})}return p.a.createElement("div",{className:"Render",style:this.props.style},p.a.createElement("svg",{onClick:this.popoutRender.bind(this),xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},p.a.createElement("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"})),p.a.createElement("iframe",{title:"Audience Render",ref:this.iframeRef,src:"/render"}))}},{key:"popoutRender",value:function(){this.poppedOut.push(window.open("/render"))}}]),t}(u.Component),$=Object(r.b)(function(e){return e},function(e){return{globalActions:R(e)}})(J),G=(n(110),function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(o.a)(this,Object(c.a)(t).call(this,e))).state={divider:70,horizontalDivider:75},n.appRef=p.a.createRef(),n}return Object(l.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.props.globalActions.connect(this.props.connection.url,this.props.connection.port)}},{key:"render",value:function(){return p.a.createElement("div",{onDragOver:function(e){e.preventDefault()},ref:this.appRef,className:"App",tabIndex:"0",onKeyDown:this.macros.bind(this)},p.a.createElement(x,{style:{width:this.state.divider+"%"}}),p.a.createElement("div",{id:"rightPanel",style:{width:100-this.state.divider+"%"}},p.a.createElement(z,{style:{height:this.state.horizontalDivider+"%"}}),p.a.createElement($,{style:{height:100-this.state.horizontalDivider+"%"}})))}},{key:"dividerResize",value:function(e){this.setState({divider:100*e/document.body.clientWidth})}},{key:"dividerResizeRightPanel",value:function(e){this.setState({horizontalDivider:100*e/document.body.clientHeight})}},{key:"macros",value:function(e){e.ctrlKey&&("s"===e.key?(e.preventDefault(),this.props.globalActions.save()):"l"===e.key?(e.preventDefault(),this.props.globalActions.load()):"d"===e.key?(e.preventDefault(),this.props.globalActions.download()):"o"===e.key&&(e.preventDefault(),this.props.globalActions.openFile()))}}]),t}(u.Component)),Y=Object(r.b)(function(e){return e},function(e){return{globalActions:R(e)}})(G),Q=n(45),X=n(71),Z=n.n(X),ee=n(75),te=n(35),ne=n(72),ae=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(o.a)(this,Object(c.a)(t).call(this,e))).state={},n}return Object(l.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("message",function(t){t.origin===window.location.origin&&e.setState(t.data.state)})}},{key:"render",value:function(){return p.a.createElement(ne.a,this.state)}}]),t}(u.Component);n.d(t,"store",function(){return re});var re=Object(Q.c)(function(){var e,t,n,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P.defaultState,r=arguments.length>1?arguments[1]:void 0;switch(r.type){case T.Types.CONNECT:var s={url:r.url,port:r.port,isConnected:r.isConnected};return Object.assign({},a,{connection:s});case T.Types.UPDATE_TEMPO:return Object.assign({},a,{tempo:r.tempo});case T.Types.ADD_TRACK:return Object.assign({},a,{tracks:[].concat(Object(j.a)(a.tracks),[Object.assign({},P.getDefaultTrack())])});case T.Types.REMOVE_TRACK:n=Object.assign({},a,{tracks:Object(j.a)(a.tracks).filter(function(e){return e.id!==r.trackId})});break;case T.Types.UPDATE_BOOT_SCRIPT:return Object.assign({},a,{bootScript:r.bootScript});case T.Types.UPDATE_TRACK:return e=a.tracks.find(function(e){return e.id===r.value.id}),t=Object.assign({},e,r.value),Object.assign({},a,{tracks:a.tracks.map(function(e){return e.id===t.id?t:e})});case T.Types.COPY_STEMS:return Object.assign({},a,{copy:r.stems});case T.Types.PASTE_STEMS:if(!a.copy.length)return a;var i=function(e){var t=a.tracks.findIndex(function(t){return t.id===e.trackId});return{trackIndex:t,stemIndex:a.tracks[t].stems.findIndex(function(t){return t.id===e.id})}},o=function(e,t,n){if(n.trackIndex>=e.tracks.length)return e;if(n.stemIndex>=e.tracks[n.trackIndex].stems.length)return e;var a=e.tracks[n.trackIndex],r=P.cloneStem(t);return r.trackId=a.id,r.open=!1,a.stems=e.tracks[n.trackIndex].stems.concat([]),a.stems[n.stemIndex]=r,Object.assign({},e,{tracks:e.tracks.map(function(e){return e.id===a.id?a:e})})},c=a.copy[0],l=i(c),u=i({trackId:r.trackId,id:r.stemId});return n=Object.assign({},a),a.copy.forEach(function(e){var t=i(e),a=t.trackIndex-l.trackIndex,r=t.stemIndex-l.stemIndex,s={trackIndex:u.trackIndex+a,stemIndex:u.stemIndex+r};n=o(n,e,s)}),Object.assign({},a,n);case T.Types.ADD_STEM:return e=a.tracks.find(function(e){return e.id===r.trackId}),t=Object.assign({},e,{stems:[].concat(Object(j.a)(e.stems),[P.getDefaultStem(e.id)])}),Object.assign({},a,{tracks:Object(j.a)(a.tracks).map(function(e){return e.id===r.trackId?t:e})});case T.Types.REMOVE_STEM:return e=a.tracks.find(function(e){return e.id===r.trackId}),t=Object.assign({},e,{stems:Object(j.a)(e.stems.filter(function(e){return e.id!==r.stemId}))}),Object.assign({},a,{tracks:a.tracks.map(function(e){return e.id===r.trackId?t:e})});case T.Types.UPDATE_STEM:var p=a.tracks.findIndex(function(e){return e.id===r.trackId});e=a.tracks[p],t=Object.assign({},e,{stems:Object(j.a)(e.stems).map(function(e){return e.id===r.stemId?Object.assign({},e,r.value):e})});var d=Object(j.a)(a.tracks);return d[p]=t,(n=Object.assign({},a)).tracks=d,n;case T.Types.UPDATE_MASTER_EFFECT:var f=a.masterEffects.findIndex(function(e){return e.id===r.value.id});return a.masterEffects[f]=r.value,Object.assign({},a,{masterEffects:a.masterEffects.concat([])});case T.Types.TOGGLE_LIVE:return Object.assign({},a,{live:r.live});case T.Types.SAVE:return;case T.Types.LOAD:return Object.assign({},a,r.newState);case T.Types.DOWNLOAD:return a;default:return console.warn("Unrecognized or unimplemented action: "+r.type),a}},Object(Q.a)(Z.a));Object(a.render)(p.a.createElement(ee.a,null,p.a.createElement(r.a,{store:re},p.a.createElement(te.a,{path:"/",exact:!0,component:Y})),p.a.createElement(te.a,{path:"/render",exact:!0,component:ae})),document.getElementById("root"))},42:function(e,t,n){"use strict";var a=n(0),r=n.n(a),s=(n(108),{language:"Hydra",getCode:function(e,t){var n=e.tracks.map(function(e){return function(e,t){var n=e.stems.filter(function(e){return e.on&&"Hydra"===e.language&&""!==e.code}).map(i);if(n.length<1)return null;for(var a=n[0],r=1;r<n.length;r++)a="".concat(a,".").concat(t,"(").concat(n[r],")");return a}(e,t)}).filter(function(e){return null!==e});if(n.length<1)return"solid(0,0,0,0).out()";for(var a=n[0],r=1;r<n.length;r++)a="".concat(a,".").concat(t,"(").concat(n[r],")");return a+=".out()"},getAudienceDom:function(e){return r.a.createElement("div",{className:"code"},s.getCode(e,"add"))}});function i(e){return e.code}n(109);var o={language:"TidalCycles",getCode:function(e){var t="stack [",n=e.tracks.map(f).filter(function(e){return""!==e});t+=n.join(", ")+"]";var a=e.masterEffects.filter(function(e){return e.on}),r=a.map(p).join(" $ ");return"d1 $ ".concat(r).concat(a.length?" $ ":"").concat(t)},trackToCode:f,getTempoCode:function(e){return"setcps "+e.tempo/60/2},getAudienceDom:function(e){var t=e.tracks.map(c).filter(function(e){return e});t=t.map(function(e){return[e,","]}).flat().slice(0,-1);var n=e.masterEffects.filter(function(e){return e.on}).map(u).filter(function(e){return e});return n=n.map(function(e){return[e," . "]}).flat().slice(0,-1),r.a.createElement("div",{className:"code TidalCycles"},"d1 $ ",n," ",n.length?"$":""," stack [",t,"]")}};function c(e){var t=e.stems.filter(function(e){return e.on&&"TidalCycles"===e.language}).map(l).filter(function(e){return e});if(!t.length)return null;t=t.map(function(e){return[e,","]}).flat().slice(0,-1);var n=e.effects.filter(function(e){return e.on}).map(u).filter(function(e){return e});return n=n.map(function(e){return[e," . "]}).flat().slice(0,-1),r.a.createElement("div",{key:e.id,className:"trackCode"},n," ",n.length?" $ ":" ","stack [",t,"]")}function l(e){var t=d(e);if(""===t||"silence"===t)return null;var n=e.effects.filter(function(e){return e.on}).map(u).filter(function(e){return e});return n=n.map(function(e){return[e," . "]}).flat().slice(0,-1),r.a.createElement("div",{key:e.id,className:"stemCode"},n," ",t)}function u(e){if(!e.on)return null;var t=p(e);return r.a.createElement("div",{className:"effectCode"},t)}function p(e){return"(".concat(e.operator," ").concat(e.name," ").concat(e.value,")")}function d(e){var t=e.effects.filter(function(e){return e.on}),n=t.map(p).join(" $ ");return n+=t.length?" $ ":"",n+=e.code}function f(e){var t=e.stems.filter(function(e){return e.on&&"TidalCycles"===e.language&&""!==e.code}).map(d).join(", ");if(""===t)return"";var n=e.effects.map(p).join(" $ ")+(e.effects.length?" $ ":"");return"".concat(n," stack [").concat(t,"]")}n.d(t,"a",function(){return h});var h={Hydra:s,TidalCycles:o}},72:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return AudienceRender});var C_Users_jamie_Documents_Dead_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(9),C_Users_jamie_Documents_Dead_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7),C_Users_jamie_Documents_Dead_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(10),C_Users_jamie_Documents_Dead_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(11),C_Users_jamie_Documents_Dead_node_modules_babel_runtime_helpers_esm_inherits__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(12),react__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_5__),hydra_synth__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(73),hydra_synth__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(hydra_synth__WEBPACK_IMPORTED_MODULE_6__),_index_css__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(136),_index_css__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_index_css__WEBPACK_IMPORTED_MODULE_7__),_Renderers__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(42),AudienceRender=function(_Component){function AudienceRender(e){var t;return Object(C_Users_jamie_Documents_Dead_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__.a)(this,AudienceRender),(t=Object(C_Users_jamie_Documents_Dead_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_2__.a)(this,Object(C_Users_jamie_Documents_Dead_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_3__.a)(AudienceRender).call(this,e))).hydraRef=react__WEBPACK_IMPORTED_MODULE_5___default.a.createRef(),t.hydraCode="",t}return Object(C_Users_jamie_Documents_Dead_node_modules_babel_runtime_helpers_esm_inherits__WEBPACK_IMPORTED_MODULE_4__.a)(AudienceRender,_Component),Object(C_Users_jamie_Documents_Dead_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_1__.a)(AudienceRender,[{key:"componentDidMount",value:function(){window.hydra=new hydra_synth__WEBPACK_IMPORTED_MODULE_6___default.a({canvas:this.hydraRef.current})}},{key:"render",value:function render(){var hydraDom,tidalDom;if(this.props.tracks){hydraDom=_Renderers__WEBPACK_IMPORTED_MODULE_8__.a.Hydra.getAudienceDom(this.props),tidalDom=_Renderers__WEBPACK_IMPORTED_MODULE_8__.a.TidalCycles.getAudienceDom(this.props);var hydraCode=_Renderers__WEBPACK_IMPORTED_MODULE_8__.a.Hydra.getCode(this.props);if(hydraCode!==this.hydraCode){try{eval(hydraCode)}catch(e){console.warn("Hydra ERR:",e)}this.hydraCode=hydraCode}}return react__WEBPACK_IMPORTED_MODULE_5___default.a.createElement("div",{className:"AudienceRender"},react__WEBPACK_IMPORTED_MODULE_5___default.a.createElement("canvas",{ref:this.hydraRef}),react__WEBPACK_IMPORTED_MODULE_5___default.a.createElement("div",{className:"code"},react__WEBPACK_IMPORTED_MODULE_5___default.a.createElement("div",{id:"tidalcycles",className:"column"},tidalDom),react__WEBPACK_IMPORTED_MODULE_5___default.a.createElement("div",{id:"hydra",className:"column"},hydraDom)))}}]),AudienceRender}(react__WEBPACK_IMPORTED_MODULE_5__.Component)},80:function(e,t,n){e.exports=n(138)},89:function(e,t,n){},90:function(e,t,n){},91:function(e,t,n){},92:function(e,t,n){}},[[80,1,2]]]);
//# sourceMappingURL=main.0ac3151d.chunk.js.map